{% extends 'base.html' %}

{% block title %}
	Admin Page
{% endblock %}

{% block body %}

<head>
	<!--sample button event, maybe pull from latest table entry after adding?
	something about checking what table and who is being added to where, and maybe 
	we can have a modular alert system -->
	<script>
		function showTeamSuccess() {
			
		  alert ("Officer added!");
		}
	</script>
	<style>
		body {
			background-color: #c3b680;
		}
	</style>
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
</head>
{% block custom_head %}
<script type="text/javascript" src="../static/js/tinymce/tinymce.min.js"></script>
<script type="text/javascript">
	tinymce.init({
		selector: "#content",
		plugins: ['link','image','code'],
		toolbar: 'bold italic backcolor | alignleft aligncenter alignright alignjustify | code',
		images_upload_url: '/uploadimage',
		images_reuse_filename: false
	});

</script>
{% endblock %}
<div class="jumbotron text-center">
	<h1>Admin Page</h1>
</div>


<!-- Script for displaying tabs -->
<!-- https://www.w3schools.com/w3css/w3css_tabulators.asp -->
<script>
function openTab(tabName) {
  var i;
  var x = document.getElementsByClassName("tab");
  for (i = 0; i < x.length; i++) {
    x[i].style.display = "none";  
  }
  document.getElementById(tabName).style.display = "block";  
}
</script>

<div class="container-fluid">

	<!--<div class="w3-bar w3-black">-->
	<div class="w3-bar green_back_gold_front">
  		<button class="w3-bar-item w3-button" onclick="openTab('Players')">Players</button>
  		<button class="w3-bar-item w3-button" onclick="openTab('Alumni')">Alumni</button>
  		<button class="w3-bar-item w3-button" onclick="openTab('TeamMembers')">Team Members</button>
  		<button class="w3-bar-item w3-button" onclick="openTab('Officers')">Officers</button>
		<button class="w3-bar-item w3-button" onclick="openTab('Content')">Content Blocks</button>
	</div>

	<!-- Players tab -->
	<div id="Players" class="w3-container tab">
		<h2>Players</h2>
		<div class="row row-cols-4 row-cols-sm-4 g-lg-1">
			<div class="col-4">
				<div class="card mb-2 green_back_gold_front">
					<div class="row g-0">
    					<h4>Specify players to delete here: </h4>
						<!-- form to delete players by name-->
						<form method="POST">
  							<label for="deleteplayer">Player Name:</label><br>
    						<input name="deleteplayer" value ="Jane Doe" class="form-control"><br>
    						<input type="submit" id='delete-form' name='delete-form' value="Delete Player" class="btn btn-outline-dark green_back_gold_front_lightened">
						</form> 
						<hr/>
					</div>
				</div>
			</div>
			<div class="col-4">
				<div class="card mb-2 green_back_gold_front">
					<div class="row g-0">
						<h4>Specify players to add here: </h4>
						<!-- form to add players -->
						<form method="POST" id="add-form" name="add-form" enctype="multipart/form-data">
  							<label for="addname">Player Name:</label><br>
  							<input type="text" id="addname" name="addname" value="John Doe" class="form-control"><br>
  							<label for="desc">Player Description:</label><br>
  							<input type="text" id="desc" name="desc" value="... player description here ..." class="form-control"><br>
  							<label for="file">Profile Picture:</label><br>
  							<input type="file" id="file" name="file" class="form-control"><br>
  							<input type="submit" id='add-form' name='add-form' value="Add Player" class="btn btn-outline-dark green_back_gold_front_lightened">
						</form> 
						<hr/>
					</div>
				</div>
			</div>
		</div>
		<div class="container">
			<hr/>
			<div class="row">
				<h2>Players:</h2>
				{% for tup in players %}
					<h5>{{ tup[0] }}</h5>
					<img src="static/image_uploads/{{ tup[2] }}" 
						alt="{{ tup[0] }} profile photo." 
						style="display:block; max-width:180px; max-height:180px; width:auto; height:auto;"
					>
					<p>{{ tup[1] }}</p>
				{% endfor %}
			</div>
			<hr/>
		</div>
	</div>

	<!-- Alumni Tab -->
	<div id="Alumni" class="w3-container tab" style="display:none">
		<h2>Alumni</h2>
		<div class="col-4">
			<div class="card mb-2 green_back_gold_front">
				<div class="row g-0">
					<h4>Specify alumni to delete here: </h4>
					<!-- form to delete players by name-->
					<form method="POST">
						<label for="delete">Player Name:</label><br>
	  					<input name="deletealumni" value ="Jane Doe" class="form-control"><br>
	  					<input type="submit" id='delete-form' name='alumni-delete-form' value="Delete Alumni" class="btn btn-outline-dark green_back_gold_front_lightened">
    				</form> 
    				<hr/>
				</div>
			</div>
		</div>
		<div class="col-4">
			<div class="card mb-2 green_back_gold_front">
				<div class="row g-0">
					<h4>Specify players to add to alumni: </h4>
					<!-- form to add players -->
					<form method="POST" id="add-form" name="alumni-add-form" enctype="multipart/form-data">
  						<label for="addname">Alumni Name:</label><br>
  						<input type="text" id="addname" name="alumni-addname" value="John Doe" class="form-control"><br>
  						<label for="desc">Alumni Description:</label><br>
  						<input type="text" id="desc" name="alumni-desc" value="... player description here ..." class="form-control"><br>
  						<label for="file">Alumni Picture:</label><br>
  						<input type="file" id="file" name="alumni-file" class="form-control"><br>
  						<input type="submit" id='add-form' name='alumni-add-form' value="Add Alumni" class="btn btn-outline-dark green_back_gold_front_lightened">
					</form> 
				</div>
			</div>
		</div>
	</div>

	<!-- Team Members tab -->
	<div id="TeamMembers" class="w3-container tab" style="display:none">
		<h2>Team Members</h2>
		<div class="col-4">
			<div class="card mb-2 green_back_gold_front">
				<div class="row g-0">
					<h4>Specify team members to delete here: </h4>
					<!-- form to delete players by name-->
					<form method="POST">
						<label for="deleteteam">Player Name:</label><br>
						<input name="deleteteam" value ="Jane Doe" class="form-control"><br>
						<input type="submit" id='delete-form' name='team-delete-form' value="Delete Team Member" class="btn btn-outline-dark green_back_gold_front_lightened">
					</form> 
				</div>
			</div>
		</div>
		<div class="col-4">
			<div class="card mb-2 green_back_gold_front">
				<div class="row g-0">
					<h4>Specify players to add to team members: </h4>
					<!-- form to add players -->
					<form method="POST" id="add-form" name="team-add-form" enctype="multipart/form-data">
						<label for="addname">Team Member Name:</label><br>
						<input type="text" id="addname" name="team-addname" value="John Doe" class="form-control"><br>
						<label for="desc">Player Description:</label><br>
						<input type="text" id="desc" name="team-desc" value="... player description here ..." class="form-control"><br>
						<label for="desc">Role Description:</label><br>
						<input type="text" id="desc" name="role-desc" value="... role description here ... ex.(role 1)" class="form-control"><br>
						<label for="file">Team Member Picture:</label><br>
						<input type="file" id="file" name="team-file" class="form-control"><br>
						<input type="submit" id='add-form' name='team-add-form' value="Add Team Member" class="btn btn-outline-dark green_back_gold_front_lightened">
					</form> 
				</div>
			</div>
		</div>
	</div>


	<!-- Officers tab -->
	<div id="Officers" class="w3-container tab" style="display:none">
		<h2>Officers</h2>
		<div class="col-4">
			<div class="card mb-2 green_back_gold_front">
				<div class="row g-0">
					<h4>Specify officers to delete here: </h4>
					<!-- form to delete officers by name-->
					<form method="POST">
						<label for="deleteofficers">Player Name:</label><br>
						<input name="deleteofficers" value ="Jane Doe" class="form-control"><br>
						<input type="submit" id='delete-form' name='officers-delete-form' value="Delete Officers" class="btn btn-outline-dark green_back_gold_front_lightened">
					</form> 
				</div>
			</div>
		</div>
		<div class="col-4">
			<div class="card mb-2 green_back_gold_front">
				<div class="row g-0">
					<h4>Specify officers to add to about page: </h4>
					<!-- form to add officers -->
					<form method="POST" id="add-form" name="officers-add-form" enctype="multipart/form-data">
						<label for="addname">Officer Name:</label><br>
						<input type="text" id="addname" name="officers-addname" value="John Doe" class="form-control"><br>
						<label for="desc">Officer Description:</label><br>
						<input type="text" id="desc" name="officers-desc" value="... officer description here ..." class="form-control"><br>
						<label for="file">Officer Picture:</label><br>
						<input type="file" id="file" name="officers-file" class="form-control"><br>
						<input type="submit" id='add-form' name='officers-add-form' value="Add Officer" class="btn btn-outline-dark green_back_gold_front_lightened" 
						onclick="showTeamSuccess()">
					</form> 
					<hr/>
				</div>
			</div>
		</div>
	</div>

	<!-- Content Block -->
	<div id="Content" class="w3-container tab" style="display:none">
		<h2>Content Blocks</h2>
		<div class="alert alert-success" role="alert" style="display: none;">
			Updated the content successfully!</div>
		<div class="row">
			<div class="col">
				<hr/>
				<div class="row">
					<h2>Blocks</h2>
					<table id="block_table" class="table table-hover table-striped table-bordered dataTable dtr-inline" role="grid" aria-describedby="example_info">
						<thead>
						<tr role="row">
							<th  rowspan="1" colspan="1" style="width: 140.2px;" aria-sort="ascending" aria-label="Name: activate to sort column descending">Title</th>
							<th  rowspan="1" colspan="1" style="width: 216.2px;" aria-label="Slug: activate to sort column ascending">Slug</th>
							<th  rowspan="1" colspan="1" style="width: 100.2px;" aria-label="Modified Date: activate to sort column ascending">Modified Date</th>
						</tr>
						</thead>
						<tbody>
						{% for tup in blocks %}
						<tr role="row" class="odd">
							<td tabindex="0" class="sorting_1"><a class="editBlockAction" data-el="{{ tup[0] }}" href="#">{{ tup[1] }}</a></td>
							<td>{{ tup[0] }}</td>
							<td>{{ tup[3] }}</td>
						</tr>
						{% endfor %}
						</tbody>
					</table>
				</div>
				<hr/>
			</div>
			<div class="col">
					<div class="row g-0">		
					<form method="POST" name="update-page" id="formContent">
						<div id="currentSlug" style="display: none;"></div>
						<textarea id="content"></textarea>
						<button type="submit" id="btnUdpateContent" class="mb-2 mr-2 btn btn-outline-2x btn-outline-success"">Update</button>
						<input id='tinymce-uploader' type='file' name='pic' accept='image/*'' style='display:none'>
					</form>			
				</div>
			
			</div>
		</div>
	</div>
<a href="logout" class="btn btn-outline-dark green_back_gold_front_lightened" role="button">Logout</a>
</div>
<br>
<script type="text/javascript">
	var editor = document.querySelector("#content");
	var slug = document.querySelector("#currentSlug");
	var btnEditBlock = document.querySelectorAll(".editBlockAction");
	var btnUpdateBlock = document.querySelector("#btnUdpateContent");
	var formContent = document.querySelector("#formContent");
	var message = document.querySelector(".alert-success");
	btnEditBlock.forEach((btnEdit) => {
		btnEdit.addEventListener("click", function(e){
			message.style.display = "none";
		fetch('/editpage', {
			headers : {
				'Content-Type' : 'application/json'
			},
			method : 'POST',
			body : JSON.stringify( {
				'slug' : e.target.getAttribute('data-el'),
			})
		})
		.then(function (response){
			if(response.ok) {
				response.json()
				.then(function(response) {
					tinymce.activeEditor.setContent(response.data[0][2]);
					slug.innerHTML = response.data[0][0];
				});
				
			}
			else {
				throw Error('Error');
			}
		})
			.catch(function(error) {
			console.log(error);
		});
		});
	});

	formContent.addEventListener("submit", function(e){
		fetch('/updatecontent', {
			headers : {
				'Content-Type' : 'application/json'
			},
			method : 'POST',
			body : JSON.stringify( {
				'slug' : slug.textContent,
				'content': tinymce.activeEditor.getContent()
			})
		})
		.then(function (response){
			if(response.ok) {
				response.json()
				.then(function(response) {
					console.log(response);
					tinymce.activeEditor.setContent(response.data[0][2]);
					slug.innerHTML = response.data[0][0];
					
					message.innerHTML = response.message;
					message.style.display = "block";
				});
				
			}
			else {
				throw Error('Error');
			}
		})
			.catch(function(error) {
			console.log(error);
		});
		e.preventDefault();
		return false;
	});
	


</script>
{% endblock %}
